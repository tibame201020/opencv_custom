# Workflow 架構深度評估與展望

回頭審視目前的架構，這是一個基於 **「信號導向 (Signal-Oriented)」** 的彈性引擎。

## 1. 擴充節點 (Node Impl) 確實是發展核心
針對您的問題：**「是否只要擴充 node 的 impl 就足以涵蓋絕大部分情境？」**

**答案是：是的。** 
對於大多數「自動化工具」與「資料處理流程」來說，90% 的功能都取決於節點的執行能力。因為：
- **邏輯控制已滿足**：透過環狀結構與信號機制，目前的 `FlowEngine` 已經具備了 Turing Complete 的潛力（能組出循環、分支、嵌套）。
- **組合靈活性**：只要有正確的節點，使用者可以在不重寫 Java 代碼的情況下，透過 JSON 定義（未來）來改變業務邏輯。

---

## 2. 未來邁向「工業級」的 3 個關鍵擴充方向

儘管擴充節點能解決大部分問題，但在處理極其複雜的工作流時，以下三個維度是目前的架構可以再強化的：

### A. 執行上下文 (Execution Context / Memory)
- **現狀**：數據是線性傳遞的（前一個節點傳給下一個）。
- **挑戰**：如果第 10 個節點需要用到第 1 個節點的元數據，現在必須在中間所有節點都帶著這份資料走。
- **發展方向**：建立一個全域的 `ExecutionContext`，讓節點可以透過鍵值存取歷史節點的輸出（例如 n8n 的 `$node["Login"].json.token`）。

### B. 並行執行 (Parallel Execution)
- **現狀**：引擎是單執行緒循序執行。
- **挑戰**：無法同時開啟多個並行任務（例如同時在多台手機執行 ADB 操作並等待彙整結果）。
- **發展方向**：將 `FlowEngine` 升級為支援分支並發 (Split/Join)，利用 Java 21 的虛擬執行緒 (Virtual Threads) 處理阻塞型 Node。

### C. 全域錯誤策略 (Global Recovery Strategy)
- **現狀**：錯誤處理依賴於在每條邊判斷 `error` 信號。
- **挑戰**：當流程很大時，邊線會變得異常雜亂（Spaghetti workflow）。
- **發展方向**：實作「預設錯誤攔截節點」。當任何節點發生失敗且沒有定義 `error` 邊時，自動導向一個全域的 `ErrorHandlerSubWorkflow`。

---

## 3. 結論與建議

您目前的架構方向非常正確，**「信號邊界控制」** 確保了系統的開放性。

**目前最優先的產出建議：**
1. **持續擴充領域節點 (Domain Specific Nodes)**：例如 ADB 操作、OpenCV 找圖、OCR 節點。這能立即產生業務價值。
2. **抽象化 Node 註冊機制**：建立一個 Plugin 模式，讓新節點的加入不需要修改到主要的 `WorkflowNode` 類別，而是透過註冊表動態載入。
